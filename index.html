<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vodafone / National Grid POWRA</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
  h1 { text-align: center; }
  .header { display: flex; justify-content: space-between; align-items: center; }
  .header img { height: 50px; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: #fff; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #eee; }
  textarea { width: 100%; height: 100px; }
  .checkbox-list label { display: block; margin: 4px 0; }
  .signature-pad { border: 1px solid #000; width: 100%; height: 120px; }
  .sig-container { margin-bottom: 20px; }
  button { padding: 6px 12px; margin-top: 5px; }
  a#w3wLink { display: block; margin-top: 5px; color: blue; text-decoration: underline; }
</style>
</head>
<body>

<div class="header">
  <img src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Vodafone_2017_logo.svg" alt="Vodafone">
  <h1>Daily Point of Work Risk Assessment (POWRA)</h1>
  <img src="https://upload.wikimedia.org/wikipedia/commons/7/75/National_Grid_logo.svg" alt="National Grid">
</div>

<p><strong>Date/Time:</strong> <span id="datetime"></span></p>

<h2>Job Details</h2>
<table>
<tr><th>Contract</th><td><input type="text" style="width:100%"></td></tr>
<tr><th>CBOL Number</th><td><input type="text" style="width:100%"></td></tr>
<tr><th>Supervisor Name & Contact</th><td><input type="text" style="width:100%"></td></tr>
<tr><th>CP in charge</th>
<td>
<select style="width:100%">
  <option value="">-- Select CP --</option>
  <option>Warren Barron</option>
  <option>Carl Carlisle</option>
  <option>Joe Smith</option>
  <option>Matt Bodrozic</option>
  <option>Bobby Rehman</option>
  <option>Mick Waine</option>
</select>
</td></tr>
<tr><th>Location</th><td><input type="text" style="width:100%"></td></tr>
<tr><th>W3W Location</th>
<td>
  <input id="w3wField" type="text" style="width:80%" readonly placeholder="Press button to fetch">
  <button type="button" onclick="getW3W()">Get Current W3W</button>
  <a id="w3wLink" href="#" target="_blank" style="display:none;">Open in What3Words</a>
</td></tr>
<tr><th>Work Type</th>
<td>
<select style="width:100%">
  <option value="">-- Select Work Type --</option>
  <option>Overhead works</option>
  <option>HV Substation</option>
  <option>Telco Room</option>
  <option>GDC</option>
</select>
</td></tr>
</table>

<h2>Section A – Start Safe</h2>
<div class="checkbox-list">
  <label><input type="checkbox"> Correct location confirmed</label>
  <label><input type="checkbox"> Vehicles/plant parked safely</label>
  <label><input type="checkbox"> Job Pack discussed</label>
  <label><input type="checkbox"> Risk Assessments referenced</label>
  <label><input type="checkbox"> Work area inspected for hazards</label>
  <label><input type="checkbox"> Precautions (trees, dust, nests, etc)</label>
  <label><input type="checkbox"> NOC notified</label>
  <label><input type="checkbox"> Permit boards available</label>
  <label><input type="checkbox"> Work area demarcated</label>
  <label><input type="checkbox"> PPE checked</label>
  <label><input type="checkbox"> Tools & plant inspected</label>
  <label><input type="checkbox"> Gas detector checked</label>
  <label><input type="checkbox"> Rescue kit available</label>
  <label><input type="checkbox"> Team members competent</label>
  <label><input type="checkbox"> First Aid / COSHH sheets available</label>
  <label><input type="checkbox"> Pre-start geo-sight images taken</label>
</div>

<h2>Section B – Other Significant Info</h2>
<textarea placeholder="Enter site-specific hazards and controls here..."></textarea>

<h2>Section C – Work Safe</h2>
<div class="checkbox-list">
  <label><input type="checkbox"> Wayleaves checked</label>
  <label><input type="checkbox"> Correct lifting equipment</label>
  <label><input type="checkbox"> Gas detector in use</label>
  <label><input type="checkbox"> Climbing harness inspected</label>
  <label><input type="checkbox"> Hospital location briefed</label>
  <label><input type="checkbox"> COSHH sheets available</label>
  <label><input type="checkbox"> Site geo-sight images taken</label>
  <label><input type="checkbox"> Vehicles locked & secured</label>
  <label><input type="checkbox"> Team briefed on risks/controls</label>
</div>

<h2>Team Signatures</h2>
<div id="signatures"></div>
<button onclick="addSignature()">Add Team Member Signature</button>

<br><br>
<button onclick="window.print()">Export to PDF</button>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
<script>
// Auto date/time
document.getElementById("datetime").textContent = new Date().toLocaleString();

// Fetch current W3W using GPS + API, then make it clickable
function getW3W() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(success, error);
  } else {
    alert("Geolocation not supported on this device.");
  }
}

function success(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  fetch(`https://api.what3words.com/v3/convert-to-3wa?coordinates=${lat},${lng}&key=0OHVUL46`)
    .then(res => res.json())
    .then(data => {
      if (data.words) {
        document.getElementById("w3wField").value = data.words;
        const link = document.getElementById("w3wLink");
        link.href = "https://what3words.com/" + data.words;
        link.style.display = "inline";
      } else {
        alert("Could not fetch W3W address.");
      }
    })
    .catch(() => alert("Error contacting W3W API."));
}

function error() {
  alert("Unable to retrieve location.");
}

// Signature pad logic
let sigCount = 0;
function addSignature() {
  sigCount++;
  const container = document.createElement("div");
  container.className = "sig-container";
  container.innerHTML = `
    <p><strong>Team Member ${sigCount}</strong></p>
    <canvas id="sig${sigCount}" class="signature-pad"></canvas>
    <button type="button" onclick="clearSig(${sigCount})">Clear</button>
  `;
  document.getElementById("signatures").appendChild(container);
  const canvas = document.getElementById("sig"+sigCount);
  const pad = new SignaturePad(canvas);
  canvas.width = canvas.offsetWidth;
  canvas.height = 120;
  pad.clear();
  window["pad"+sigCount] = pad;
}
function clearSig(n) {
  if (window["pad"+n]) window["pad"+n].clear();
}
</script>

</body>
</html>
